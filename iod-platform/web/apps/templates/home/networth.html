{% extends "layouts/base.html" %}
{% load static %}

{% block title %} Networth Summary {% endblock %} 

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<style>
    .right-align {
        float: right;
        clear: both; /* Clear float to prevent overlapping */
    }
</style>
<!-- enjoyhint css -->
<link rel="stylesheet" href="{% static 'assets/css/plugins/introjs.min.css' %}">

{% endblock stylesheets %}

{% block content %}
   <!-- [ Main Content ] start -->
   <div class="pcoded-main-container">
        <div class="pcoded-wrapper">
            <div class="pcoded-content">
                <div class="pcoded-inner-content">
                    <!-- [ breadcrumb ] start -->
                    <div class="page-block">
                        <div class="row align-items-center">
                            <div class="col-md-12">
                                <div class="page-header-title">
                                    <h5 class="m-b-10"></h5>
                                </div>
                                <ul class="breadcrumb">
                                    
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- [ breadcrumb ] end -->
                    <div class="main-body">
                        <div class="page-wrapper">
                            <div class="row">
                                <div class="col-sm-9">
                                    <div class="card">
                                        <div class="card-header networth-summary-step1">
                                            <h5>Networth Summary</h5>
                                            <a class="right-align edit-networth-step3"  href="{% url 'view_networth' %}">Edit Networth <i class="feather icon-edit"></i></a>
                                        </div>
                                        <div class="card-block table-border-style">
                                            <div class="table-responsive">
                                                {% if  category_list %}
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Category Name</th>
                                                            <th>Weightage</th>
                                                            <th>Amount Allocated</th>
                                                            <th>Amount Invested</th>
                                                            <th>Invest %</th>
                                                            <th>Current Value</th>
                                                            <th>P/L Amount</th>
                                                            <th>P/L %</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for category in category_list %}
                                                        <tr>
                                                            <th scope="row">{{forloop.counter}}</th>
                                                            <td data-id="name-{{category.name}}" data-type="name">{{category.name}}</td>
                                                            <td data-id="weightage-{{category.weightage}}" data-type="weightage">{{category.weightage}}</td>
                                                            <td data-id="allocation-{{category.get_category_allocation}}" data-type="allocation">{{category.get_category_allocation}}</td>
                                                            <td data-id="{{category.get_total_invested_amount}}" data-type="invested_amount">{{category.get_total_invested_amount}}</td>
                                                            <td data-id="diff-{{category.get_diff}}" data-type="diff">{{category.get_diff}}</td>
                                                            <td data-id="current-{{category.current_value_in_units}}" data-type="current_value">{{category.current_value_in_units}}</td>
                                                            <td data-id="pnlamount-{{category.pnl_amount}}" data-type="pnl_amount">{{category.pnl_amount}}</td>
                                                            <td style="color: {% if category.pnl_percentage < 0 %}red{% elif category.pnl_percentage > 0 %}green{% else %}black{% endif %}; font-weight: bold;">
                                                                {% if category.pnl_percentage > 0 %}+{% endif %}
                                                                {{ category.pnl_percentage }}%
                                                            </td>
                                                            <td><a class="btn btn-primary" href="category/{{category.id}}" type="submit">View Details</a></td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                    {% else %}
                                                        No categories allocation is done yet
                                                    {% endif %}
                                                    
                                                </table>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="card card-social">
                                        <div class="card-block border-bottom">
                                            <div class="row align-items-center justify-content-center">
                                                <div class="col-5">
                                                    <div>
                                                    Current value
                                                    </div>
                                                </div>
                                                <div class="col-7">
                                                    <div>
                                                    <h5>{{asset_current_value}}</h5>
                                                    <h5 class="text-c-green mb-0">+{{pnl_percentage}}% <span class="text-muted">{{pnl_amount}}</span></h5>  
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-block">
                                            <div class="row align-items-center justify-content-center card-active">
                                                <div >
                                                    <h6 class="text-center  m-b-10"><span class="text-muted m-r-5">Invested:</span>{{total_invested_amount}}
                                                        <a href="{% url 'view_base_unit' %}">{{base_unit_name}}</a>
                                                    </h6>
                                                    <div class="progress">
                                                        <div class="progress-bar progress-c-theme2" role="progressbar" style="width:{{ total_invested_percentage|safe }}%;height:6px;" 
                                                        aria-valuenow="{{total_invested_amount}}" aria-valuemin="0" aria-valuemax="{{total_asset_allocation}}"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card daily-sales">
                                        <div class="card-block">
                                            <div class="row d-flex align-items-center">
                                                <div class="col-9">
                                                    <h4 class="f-w-300 d-flex align-items-center m-b-0">
                                                    Total amount invested
                                                    </h4>
                                                </div>
                                                <div class="col-3 text-right">
                                                    <p class="m-b-0">{{total_invested_percentage}}%</p>
                                                </div>
                                            </div>
                                            <div class="progress m-t-30" style="height: 7px;">
                                                <div class="progress-bar progress-c-theme" role="progressbar" style="width: {{ total_invested_percentage|safe }}%;" 
                                                aria-valuenow="{{total_invested_amount}}" aria-valuemin="0" aria-valuemax="{{total_networth_amount}}"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card daily-sales">
                                        <div class="card-block">
                                            <div class="row d-flex align-items-center">
                                                <div class="col-9">
                                                    <h4 class="f-w-300 d-flex align-items-center m-b-0">
                                                    Total weightage used
                                                    </h4>
                                                </div>
                                                <div class="col-3 text-right">
                                                    <p class="m-b-0">{{weightage_used}}%</p>
                                                </div>
                                            </div>
                                            <div class="progress m-t-30" style="height: 7px;">
                                                <div class="progress-bar progress-c-theme" role="progressbar" style="width: {{ weightage_used|safe }}%;" 
                                                aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>   
                            </div> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>   
{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script type="text/javascript">
    var user_tour_status = "{{user_tour.status}}";
    var token = '{% csrf_token %}'
    let valueStartIndex = token.indexOf('value="') + 7; // 7 is the length of 'value="'
    let valueEndIndex = token.indexOf('">', valueStartIndex);
    let csrftoken = token.substring(valueStartIndex, valueEndIndex);
    let steps = '"' +'{{user_tour_steps_json  | escapejs }}' + '"';
    let user_tour_steps_json = '{{user_tour_steps_json  | escapejs }}';
</script>

<!-- tour Js -->
<script src="{% static 'assets/js/plugins/intro.min.js' %}"></script>
<script type="module" src="{% static 'assets/js/pages/ac-tour-first-step.js' %}"></script>

{% endblock javascripts %}